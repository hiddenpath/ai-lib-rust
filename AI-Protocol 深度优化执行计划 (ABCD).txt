AI-Protocol 深度优化执行计划 (A/B/C/D)
本计划旨在解决《专业技术审计报告》中的遗留缺陷，将 ai-lib-rust 从“功能对齐”提升至“生产就绪”水平。

1. 深度审查反馈
协议识别能力 (B): [已具备初步能力]。目前 
PolicyEngine
 已能识别 
capabilities
 并执行预校验。
错误类型统一 (C): [确实存在缺陷]。当前 
Error
 枚举中，非远程错误（如 Validation, Configuration）仍采用 String 包装，缺乏结构化上下文。
元数据与可观测性: [Signal 已安排]。SignalsSnapshot 已在收集电路、频率、负载信号，但尚未转化为对外的“决策路径追踪”。
2. 优化方向执行计划
维度 A：集中管理与动态化 (Registry & Hot-Reload)
步骤 A1: 实现 
ProtocolRegistry
 单例，管理全局模型 Manifest 缓存，避免重复 I/O。
步骤 A2: 完善热重载机制，确保 Manifest 文件变更时，已存的 
AiClient
 能够感知策略更新（如重试参数变更）。
验证: 编写集成测试，模拟在运行时修改重试次数，观察客户端行为变化。
维度 B：多模态与格式归一化 (Multimodal & Payload)
步骤 B1: 设计通用的 UnifiedMessageContent 结构，消除 Gemini 与 OpenAI 在图像/音频嵌套格式上的差异。
步骤 B2: 在各适配器（Adapter）中实现格式转换器，实现“一次输入，多端适配”。
验证: 编写跨供应商的多模态集成测试。
维度 C：错误分层与深度追踪 (Error & Observability)
步骤 C1: 重构错误体系。将 
Error
 子项改为结构化枚举（如 ValidationError { field: String, reason: String }），并与 
spec.yaml
 定义的 13 种标准错误类对齐。
步骤 C2: 决策路径追踪。在 
CallStats
 中记录 
PolicyEngine
 的决策全过程（如：“由于连续 3 次超时，熔断器打开，触发 Fallback”）。
验证: 检查错误日志是否符合结构化标准。
维度 D：服务标准化与高层封装 (Services & Wrapper)
步骤 D1: 基于 Manifest 中的 services 声明，在 
AiClient
 中提供 list_models()、get_balance() 等标准化接口。
步骤 D2: 消除 Adapter 中关于辅助接口的硬编码。
验证: 使用统一接口调用不同 Provider 的余额查询功能。
3. 优先级排序
维度 C (错误重构)：基础工程质量修复，需优先动刀。
维度 A (Registry)：提升大规模使用时的加载性能与动态性。
维度 B (多模态)：解决功能层面的不一致问题。
维度 D (服务封装)：完善开发者 UI/UX 体验。